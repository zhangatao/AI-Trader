# AI-Trader 项目使用说明

## 🎉 配置成功！

你的AI-Trader项目已经配置完成，可以使用DeepSeek API进行自动交易了！

## 📋 已完成的配置

### 1. 环境配置（.env）
- ✅ DeepSeek API密钥已配置
- ✅ Alpha Vantage API密钥已配置（用于获取股票数据）
- ✅ MCP服务端口已设置

### 2. 模型配置
- ✅ 启用了 `deepseek-chat` 模型
- ✅ 禁用了其他收费模型（Claude、GPT等）

### 3. 数据准备
- ✅ NASDAQ 100股票数据已就绪（更新至2025-11-06）
- ✅ 数据格式：小时级别价格数据

### 4. MCP服务
- ✅ 交易工具服务（端口8002）
- ✅ 价格查询服务（端口8003）
- ✅ 搜索服务（端口8001）
- ✅ 数学计算服务（端口8000）

## 🚀 快速开始

### 方法1：使用推荐配置（3小时交易）
```bash
cd /Users/zhangpengtao/Desktop/get_rich_project/AI-Trader

# 确保MCP服务正在运行（如果没有运行，先启动）
source venv/bin/activate
cd agent_tools && python start_mcp_services.py &
cd ..

# 运行AI交易
python main.py configs/deepseek_recommended_config.json
```

### 方法2：使用测试配置（1小时交易，快速验证）
```bash
cd /Users/zhangpengtao/Desktop/get_rich_project/AI-Trader
source venv/bin/activate
python main.py configs/test_config.json
```

### 方法3：自定义配置
编辑配置文件 `configs/deepseek_recommended_config.json`：
```json
{
  "date_range": {
    "init_date": "2025-10-01 10:00:00",  // 开始时间
    "end_date": "2025-10-01 13:00:00"     // 结束时间
  },
  "agent_config": {
    "max_steps": 15,        // 每小时最多AI决策步数（越大越慢但可能更仔细）
    "initial_cash": 10000.0 // 初始资金
  }
}
```

## ⚙️ 配置参数说明

### 时间设置
- **格式**：`YYYY-MM-DD HH:MM:SS`（小时级交易必须带时间）
- **建议**：初次运行建议1-3小时范围，避免等待太久

### max_steps（每小时AI决策步数）
- **10步**：快速模式，适合测试（约1-2分钟/小时）
- **15步**：推荐模式，平衡速度和质量（约2-3分钟/小时）
- **30步**：完整模式，最详细分析（约5-8分钟/小时）

### 运行时间估算
```
总时间 ≈ 交易小时数 × max_steps × 每次API调用时间(2-3秒)
例如：3小时 × 15步 × 2.5秒 = 约112秒 = 2分钟
```

## 📊 查看结果

### 1. 查看交易记录
```bash
# 查看持仓记录
cat data/agent_data/deepseek-trader/position/position.jsonl

# 格式化查看最后一条记录
tail -1 data/agent_data/deepseek-trader/position/position.jsonl | python -m json.tool
```

### 2. 查看交易日志
```bash
# 查看某一天的详细日志
ls data/agent_data/deepseek-trader/log/

# 查看具体日志文件
cat data/agent_data/deepseek-trader/log/2025-10-01/log.jsonl
```

## 🔧 故障排查

### 问题1：程序卡住不动
**原因**：时间范围太大或max_steps太高
**解决**：
- 减少时间范围到1-2小时
- 降低max_steps到10-15

### 问题2：MCP服务未运行
**错误信息**：`Connection refused` 或端口连接失败
**解决**：
```bash
cd agent_tools
python start_mcp_services.py &
```

### 问题3：API调用失败
**错误信息**：`Model Not Exist` 或 `API Key Invalid`
**解决**：
1. 检查 `.env` 文件中的API密钥是否正确
2. 确认使用 `deepseek-chat` 而不是 `deepseek/deepseek-chat`

### 问题4：查看进度
如果想看到实时进度，不要使用 `| head` 截断输出：
```bash
# 完整输出（推荐）
python main.py configs/test_config.json

# 保存到文件同时查看
python main.py configs/test_config.json 2>&1 | tee run.log
```

## 📈 成功案例

刚才的测试运行成功完成了：
- ✅ AI自主决策买入了7只股票：NVDA、MSFT、AAPL、AMZN、META、AMD、INTC
- ✅ 投资策略：重点配置AI芯片和云计算领域
- ✅ 剩余现金：$11.53
- ✅ 耗时：约10-15秒

## 🌐 可视化监控界面

### 启动Web界面
```bash
cd /Users/zhangpengtao/Desktop/get_rich_project/AI-Trader
bash scripts/start_ui.sh
```

或者手动启动：
```bash
cd docs
python3 -m http.server 8888
```

### 访问界面
打开浏览器访问：**http://localhost:8888**

### 界面功能
1. **📈 资产演化图表**（index.html）
   - 对比不同AI模型的资产增长曲线
   - 查看收益率走势
   - 与QQQ基准指数对比

2. **💼 投资组合分析**（portfolio.html）
   - 查看每个AI的当前持仓
   - 查看历史交易记录
   - 分析交易决策逻辑

3. **🏆 性能排行榜**
   - 总收益率对比
   - 夏普比率
   - 最大回撤
   - 交易次数统计

### 界面配置
前端界面配置文件：`docs/config.yaml`
- 已自动添加你的DeepSeek agent配置
- 可以自定义显示名称、颜色、图标
- 支持美股和A股市场切换

### 注意事项
- ⚠️ 确保已运行至少一次交易，生成position.jsonl数据
- 📊 界面会自动读取`data/agent_data/`目录下的所有agent数据
- 🔄 运行新的交易后，刷新浏览器即可看到更新

## 🎯 下一步

1. **小规模测试**：先用test_config.json跑1-2小时验证
2. **启动可视化**：运行bash scripts/start_ui.sh查看实时监控
3. **扩大范围**：验证成功后使用deepseek_recommended_config.json
4. **长期回测**：可以设置更长的时间范围（如1周、1个月）
5. **对比多模型**：可以同时启用多个模型进行性能对比

## 💡 重要提示

1. **API费用**：DeepSeek API按调用次数收费，注意控制max_steps和时间范围
2. **数据时效**：当前数据更新到2025-11-06，如需最新数据需重新运行数据获取脚本
3. **纯模拟**：这是回测系统，不会真实下单交易
4. **多模型对比**：可以在configs中启用多个模型同时运行，对比不同AI的交易策略

## 📞 获取帮助

- 项目README：[README.md](./README.md)
- GitHub Issues：https://github.com/HKUDS/AI-Trader/issues
- 配置示例：查看 `configs/` 目录下的各种配置文件

---

**祝你的AI交易agent运行顺利！🚀📈**

